     1                                  ; external functions from X11 library
     2                                  extern XOpenDisplay
     3                                  extern XDisplayName
     4                                  extern XCloseDisplay
     5                                  extern XCreateSimpleWindow
     6                                  extern XMapWindow
     7                                  extern XRootWindow
     8                                  extern XSelectInput
     9                                  extern XFlush
    10                                  extern XCreateGC
    11                                  extern XSetForeground
    12                                  extern XDrawLine
    13                                  extern XDrawPoint
    14                                  extern XFillArc
    15                                  extern XNextEvent
    16                                  
    17                                  ; external functions from stdio library (ld-linux-x86-64.so.2)    
    18                                  extern printf
    19                                  extern exit
    20                                  
    21                                  %define	StructureNotifyMask	131072
    22                                  %define KeyPressMask		1
    23                                  %define ButtonPressMask		4
    24                                  %define MapNotify		19
    25                                  %define KeyPress		2
    26                                  %define ButtonPress		4
    27                                  %define Expose			12
    28                                  %define ConfigureNotify		22
    29                                  %define CreateNotify 16
    30                                  %define QWORD	8
    31                                  %define DWORD	4
    32                                  %define WORD	2
    33                                  %define BYTE	1
    34                                  
    35                                  global orientation
    36                                  orientation:
    37                                      ; Coord de P dans di et si
    38                                      ; Coord de I dans dx et cx
    39                                      ; Coord de Q dans r8w et r9w
    40                                      
    41                                      ; cx sera bientôt modifié mais on doit l'utiliser 2 fois
    42                                      ; Donc on le sauvegarde
    43                                      
    44                                      
    45                                      
    46 00000000 51                          push rcx
    47 00000001 4829F1                      sub rcx, rsi
    48 00000004 4929D0                      sub r8, rdx
    49                                      
    50 00000007 490FAFC8                    imul rcx, r8
    51                                      
    52                                      ; Nous n'utiliserons plus si
    53                                      ; Donc nous restaurons la valeur de cx dans si
    54 0000000B 5E                          pop rsi
    55 0000000C 4829FA                      sub rdx, rdi
    56 0000000F 4929F1                      sub r9, rsi
    57                                      
    58 00000012 490FAFD1                    imul rdx, r9
    59                                      
    60 00000016 4829D1                      sub rcx, rdx
    61                                      
    62 00000019 4883F900                    cmp rcx, 0
    63 0000001D 7C07                        jl clockwise
    64                                      
    65 0000001F B801000000                  mov eax, 1
    66 00000024 EB05                        jmp endori
    67                                      
    68                                      clockwise:
    69 00000026 B800000000                  mov eax, 0
    70                                      
    71                                      endori:
    72 0000002B C3                      ret
    73                                  
    74                                  global main
    75                                  
    76                                  %DEFINE NUM_POINTS 5
    77                                  %DEFINE MAX_X 255
    78                                  %DEFINE MAX_Y 255
    79                                  
    80                                  section .data
    81 00000000 0000000000000000-       event:		times	24 dq 0
    81 00000000 <rep 18h>          
    82                                  
    83 000000C0 00000000                x1:	dd	0
    84 000000C4 00000000                x2:	dd	0
    85 000000C8 00000000                y1:	dd	0
    86 000000CC 00000000                y2:	dd	0
    87                                  
    88 000000D0 25640A00                fmt_printf: db "%d", 10, 0
    89 000000D4 76733A2025640A00        fmt_index: db "vs: %d", 10, 0
    90 000000DC 4D696E696D756D3A20-     fmt_min: db "Minimum: %d", 10, 0
    90 000000E5 25640A00           
    91                                  
    92 000000E9 546573740A00            test: db "Test", 10, 0
    93 000000EF 78203A2025640A00        printx: db "x : %d", 10, 0
    94 000000F7 79203A2025640A00        printy: db "y : %d", 10, 0
    95 000000FF 4F6E2074657374206C-     jpp: db "On test le point: %d...", 10, 0
    95 00000108 6520706F696E743A20-
    95 00000111 25642E2E2E0A00     
    96 00000118 417520505620646520-     jenaismarre: db "Au PV de %d...", 10, 0
    96 00000121 25642E2E2E0A00     
    97 00000128 446570756973206C65-     tuezmoi: db "Depuis le point %d", 10, 0
    97 00000131 20706F696E74202564-
    97 0000013A 0A00               
    98 0000013C 456E76656C6F707065-     env: db "Enveloppe: %d", 10, 0
    98 00000145 3A2025640A00       
    99 0000014B 436F65663A2025640A-     coef: db "Coef: %d", 10, 0
    99 00000154 00                 
   100 00000155 526573756C7461743A-     resultat: db "Resultat: %d", 10, 0
   100 0000015E 2025640A00         
   101                                  ;coordx: dw 164, 61, 126, 216, 244
   102                                  ;coordy: dw 173, 218, 61, 39, 205
   103                                  
   104                                  section .bss
   105 00000000 ????????????????        display_name:	resq	1
   106 00000008 ????????                screen:		resd	1
   107 0000000C ????????                depth:         	resd	1
   108 00000010 ????????                connection:    	resd	1
   109 00000014 ????????                width:         	resd	1
   110 00000018 ????????                height:        	resd	1
   111 0000001C ????????????????        window:		resq	1
   112 00000024 ????????????????        gc:		resq	1
   113                                  
   114 0000002C <res Ah>                coordx: resw NUM_POINTS
   115 00000036 <res Ah>                coordy: resw NUM_POINTS
   116 00000040 <res Ah>                enveloppe: resw NUM_POINTS
   117 0000004A ??                      sizeEnveloppe: resb 1
   118 0000004B ????                    randnum: resw 1
   119 0000004D ????                    minpoint: resw 1
   120                                  
   121 0000004F ????                    P: resw 1
   122 00000051 ????                    Q: resw 1
   123 00000053 ????                    I: resw 1
   124                                  
   125 00000055 ????                    lastPointX: resw 1
   126 00000057 ????                    lastPointY: resw 1
   127 00000059 ??                      isInside: resb 1
   128 0000005A ????                    checkIndex: resw 1
   129                                  
   130                                  section .text
   131                                  
   132                                  main:
   133                                  ;Génération des points du programme
   134 0000002C BB00000000              mov rbx, 0
   135                                  populatex:
   136 00000031 660FC7F0                    rdrand ax
   137 00000035 66890425[4B000000]          mov [randnum], ax
   138                                      modx:
   139 0000003D 66812C25[4B000000]-             sub word[randnum], MAX_X
   139 00000045 FF00               
   140 00000047 66813C25[4B000000]-             cmp word[randnum], MAX_X
   140 0000004F FF00               
   141 00000051 73EA                            jae modx
   142 00000053 668B0425[4B000000]          mov ax, word[randnum]
   143 0000005B 6689841B[2C000000]          mov word[coordx+rbx*2], ax    
   144 00000063 48FFC3                      inc rbx
   145 00000066 4883FB05                    cmp rbx, NUM_POINTS
   146 0000006A 72C5                        jb populatex
   147                                  
   148 0000006C BB00000000              mov rbx, 0
   149                                  populatey:
   150 00000071 F9                          stc
   151                                      checkcf:
   152 00000072 660FC7F0                        rdrand ax
   153 00000076 73FA                        jnc checkcf
   154 00000078 66890425[4B000000]          mov word[randnum], ax
   155                                      mody:
   156 00000080 66812C25[4B000000]-             sub word[randnum], MAX_Y
   156 00000088 FF00               
   157 0000008A 66813C25[4B000000]-             cmp word[randnum], MAX_Y
   157 00000092 FF00               
   158 00000094 73EA                            jae mody
   159 00000096 668B0425[4B000000]          mov ax, word[randnum]
   160 0000009E 6689841B[36000000]          mov word[coordy+rbx*2], ax
   161                                  
   162 000000A6 48FFC3                      inc rbx
   163 000000A9 4883FB05                    cmp rbx, NUM_POINTS
   164 000000AD 72C2                        jb populatey
   165                                     
   166 000000AF BB00000000              mov rbx, 0
   167                                  printloop:
   168 000000B4 48BF-                       mov rdi, printx
   168 000000B6 [EF00000000000000] 
   169 000000BE 480FB7B41B-                 movzx rsi, word[coordx+rbx*2]
   169 000000C3 [2C000000]         
   170 000000C7 B800000000                  mov rax, 0
   171 000000CC E8(00000000)                call printf
   172                                  
   173 000000D1 48BF-                       mov rdi, printy
   173 000000D3 [F700000000000000] 
   174 000000DB 480FB7B41B-                 movzx rsi, word[coordy+rbx*2]
   174 000000E0 [36000000]         
   175 000000E4 B800000000                  mov rax, 0
   176 000000E9 E8(00000000)                call printf
   177                                      
   178 000000EE 48FFC3                      inc rbx
   179 000000F1 4883FB05                    cmp rbx, NUM_POINTS
   180 000000F5 72BD                        jb printloop
   181                                  
   182                                  ; Trouver le point le plus à gauche
   183 000000F7 BB00000000              mov rbx, 0
   184 000000FC 66891C25[4D000000]      mov word[minpoint], bx
   185 00000104 48FFC3                  inc rbx
   186                                  minAlgo:
   187                                      ; On récupère le point minimum actuel
   188 00000107 480FB70C25-                 movzx rcx, word[minpoint]
   188 0000010C [4D000000]         
   189 00000110 480FB78409-                 movzx rax, word[coordx+rcx*2]
   189 00000115 [2C000000]         
   190                                      
   191                                      ; On le compare au point parcouru actuel
   192 00000119 663B841B[2C000000]          cmp ax, word[coordx+rbx*2]
   193 00000121 760B                        jbe lower
   194                                              
   195                                      ; Si minpoint > point actuel, on mets point actuel dans minpoint
   196 00000123 4889D8                      mov rax, rbx
   197 00000126 66890425[4D000000]          mov word[minpoint], ax
   198                                  
   199                                      lower:
   200 0000012E 48FFC3                      inc rbx
   201 00000131 4883FB05                    cmp rbx, NUM_POINTS
   202 00000135 72D0                        jb minAlgo
   203                                      
   204                                  ; Une fois cette étape fini, nous connaissons le point le plus à gauche.
   205                                  ; Marche de Jarvis
   206                                  ; rax = Prochain point (P)
   207                                  ; rbx = Index actuel de enveloppe (Pas d'équivalent, à ne pas utiliser pr l'instant)
   208                                  ; rcx = Prochain candidat de P (Q)
   209 00000137 4831C0                  xor rax, rax
   210 0000013A 668B0425[4D000000]      mov ax, word[minpoint]
   211 00000142 66890425[4F000000]      mov word[P], ax
   212 0000014A 66C70425[4A000000]-     mov word[sizeEnveloppe], 0
   212 00000152 0000               
   213                                  jarvis:
   214 00000154 668B0425[4F000000]          mov ax, word[P]
   215 0000015C 4831DB                      xor rbx, rbx
   216 0000015F 480FB71C25-                 movzx rbx, word[sizeEnveloppe]
   216 00000164 [4A000000]         
   217 00000168 6689841B[40000000]          mov word[enveloppe+rbx*2], ax
   218                                      
   219 00000170 66890425[51000000]          mov word[Q], ax
   220 00000178 66FF0425[51000000]          inc word[Q]
   221 00000180 66833C25[51000000]-         cmp word[Q], NUM_POINTS
   221 00000188 05                 
   222 00000189 7209                        jb nofix
   223                                      
   224 0000018B 66832C25[51000000]-         sub word[Q], NUM_POINTS
   224 00000193 05                 
   225                                      
   226                                      nofix:
   227 00000194 66C70425[53000000]-         mov word[I], 0
   227 0000019C 0000               
   228                                      parcoursListe:
   229 0000019E 668B1C25[4F000000]              mov bx, word[P]
   230 000001A6 66391C25[53000000]              cmp word[I], bx
   231 000001AE 7471                            je nocandid
   232                                          ; Coord de P dans di et si
   233 000001B0 480FBF0425-                     movsx rax, word[P]
   233 000001B5 [4F000000]         
   234 000001B9 480FBFBC00-                     movsx rdi, word[coordx+rax*2]
   234 000001BE [2C000000]         
   235 000001C2 480FBFB400-                     movsx rsi, word[coordy+rax*2]
   235 000001C7 [36000000]         
   236                                          
   237                                          ; Coord de I dans dx et cx
   238 000001CB 480FBF0425-                     movsx rax, word[I]
   238 000001D0 [53000000]         
   239 000001D4 480FBF9400-                     movsx rdx, word[coordx+rax*2]
   239 000001D9 [2C000000]         
   240 000001DD 480FBF8C00-                     movsx rcx, word[coordy+rax*2]
   240 000001E2 [36000000]         
   241                                          
   242                                          ; Coord de Q dans r8w et r9w
   243 000001E6 480FBF0425-                     movsx rax, word[Q]
   243 000001EB [51000000]         
   244 000001EF 4C0FBF8400-                     movsx r8, word[coordx+rax*2]
   244 000001F4 [2C000000]         
   245 000001F8 4C0FBF8C00-                     movsx r9, word[coordy+rax*2]
   245 000001FD [36000000]         
   246 00000201 B800000000                      mov rax, 0
   247 00000206 E8F5FDFFFF                      call orientation
   248                                          
   249 0000020B 83F800                          cmp eax, 0
   250 0000020E 7E11                            jle nocandid
   251                                          
   252 00000210 480FB71C25-                     movzx rbx, word[I]
   252 00000215 [53000000]         
   253 00000219 66891C25[51000000]              mov word[Q], bx
   254                                          
   255                                          nocandid:
   256                                          
   257 00000221 66FF0425[53000000]              inc word[I]
   258 00000229 66833C25[53000000]-             cmp word[I], NUM_POINTS
   258 00000231 05                 
   259 00000232 0F8266FFFFFF                    jb parcoursListe    
   260 00000238 668B1C25[51000000]          mov bx, word[Q]
   261 00000240 66891C25[4F000000]          mov word[P], bx
   262 00000248 66FF0425[4A000000]          inc word[sizeEnveloppe]
   263                                  
   264 00000250 668B1C25[4D000000]          mov bx, word[minpoint]
   265 00000258 66391C25[4F000000]          cmp word[P], bx
   266 00000260 0F85EEFEFFFF                jne jarvis
   267                                  
   268                                  
   269 00000266 BB00000000              mov rbx, 0
   270                                  printenv:
   271 0000026B 48BF-                       mov rdi, env
   271 0000026D [3C01000000000000] 
   272 00000275 480FB7B41B-                 movzx rsi, word[enveloppe+rbx*2]
   272 0000027A [40000000]         
   273 0000027E B800000000                  mov rax, 0
   274 00000283 E8(00000000)                call printf
   275                                  
   276 00000288 48FFC3                      inc rbx
   277 0000028B 663B1C25[4A000000]          cmp bx, word[sizeEnveloppe]
   278 00000293 72D6                        jb printenv  
   279                                      
   280 00000295 660FC7F0                rdrand ax
   281 00000299 66890425[55000000]      mov word[lastPointX], ax
   282                                  lastmodx:
   283 000002A1 66812C25[55000000]-         sub word[lastPointX], MAX_X
   283 000002A9 FF00               
   284 000002AB 66813C25[55000000]-         cmp word[lastPointX], MAX_X
   284 000002B3 FF00               
   285 000002B5 73EA                        jae lastmodx
   286                                      
   287 000002B7 660FC7F0                rdrand ax
   288 000002BB 66890425[57000000]      mov word[lastPointY], ax
   289                                  lastmody:
   290 000002C3 66812C25[57000000]-         sub word[lastPointY], MAX_Y
   290 000002CB FF00               
   291 000002CD 66813C25[57000000]-         cmp word[lastPointY], MAX_Y
   291 000002D5 FF00               
   292 000002D7 73EA                        jae lastmody
   293                                      
   294 000002D9 66C70425[5A000000]-     mov word[checkIndex], 0
   294 000002E1 0000               
   295 000002E3 66C70425[59000000]-     mov word[isInside], 1
   295 000002EB 0100               
   296                                  checkInside:
   297 000002ED 480FB70425-                 movzx rax, word[checkIndex]
   297 000002F2 [5A000000]         
   298                                      
   299 000002F6 668B9C00[40000000]          mov bx, word[enveloppe+rax*2]
   300 000002FE 66891C25[4F000000]          mov word[P], bx
   301                                      
   302 00000306 66FFC0                      inc ax
   303 00000309 66390425[4A000000]          cmp word[sizeEnveloppe], ax
   304 00000311 7512                        jne nolooped
   305                                      
   306 00000313 668B1C25[40000000]          mov bx, word[enveloppe]
   307 0000031B 66891C25[53000000]          mov word[I], bx
   308 00000323 EB10                        jmp endlooped
   309                                      
   310                                      nolooped:
   311 00000325 668B9C00[40000000]          mov bx, word[enveloppe+(rax)*2]
   312 0000032D 66891C25[53000000]          mov word[I], bx
   313                                      
   314                                      endlooped:
   315 00000335 668B1C25[4F000000]          mov bx, word[P]
   316 0000033D 66391C25[53000000]          cmp word[I], bx
   317 00000345 0F84D6FEFFFF                je nocandid
   318                                      ; Coord de P dans di et si
   319 0000034B 480FBF0425-                 movsx rax, word[P]
   319 00000350 [4F000000]         
   320 00000354 480FBFBC00-                 movsx rdi, word[coordx+rax*2]
   320 00000359 [2C000000]         
   321 0000035D 480FBFB400-                 movsx rsi, word[coordy+rax*2]
   321 00000362 [36000000]         
   322                                          
   323                                      ; Coord de I dans dx et cx
   324 00000366 480FBF0425-                 movsx rax, word[I]
   324 0000036B [53000000]         
   325 0000036F 480FBF9400-                 movsx rdx, word[coordx+rax*2]
   325 00000374 [2C000000]         
   326 00000378 480FBF8C00-                 movsx rcx, word[coordy+rax*2]
   326 0000037D [36000000]         
   327                                      
   328                                      ; Coord de lastPoint dans r8w et r9w
   329 00000381 4C0FBF0425-                 movsx r8, word[lastPointX]
   329 00000386 [55000000]         
   330 0000038A 4C0FBF0C25-                 movsx r9, word[lastPointY]
   330 0000038F [57000000]         
   331 00000393 B800000000                  mov rax, 0
   332 00000398 E863FCFFFF                  call orientation
   333                                      
   334 0000039D 83F800                      cmp eax, 0
   335 000003A0 7F08                        jg nextCheck
   336                                      
   337 000003A2 C60425[59000000]00          mov byte[isInside], 0
   338                                      
   339                                      nextCheck:
   340 000003AA 66FF0425[5A000000]          inc word[checkIndex]
   341 000003B2 480FB70425-                 movzx rax, word[sizeEnveloppe]
   341 000003B7 [4A000000]         
   342 000003BB 66390425[5A000000]          cmp word[checkIndex], ax
   343 000003C3 0F8224FFFFFF                jb checkInside
   344                                  
   345 000003C9 48BF-                       mov rdi, printx
   345 000003CB [EF00000000000000] 
   346 000003D3 480FB73425-                 movzx rsi, word[lastPointX]
   346 000003D8 [55000000]         
   347 000003DC B800000000                  mov rax, 0
   348 000003E1 E8(00000000)                call printf
   349                                      
   350 000003E6 48BF-                       mov rdi, printy
   350 000003E8 [F700000000000000] 
   351 000003F0 480FB73425-                 movzx rsi, word[lastPointY]
   351 000003F5 [57000000]         
   352 000003F9 B800000000                  mov rax, 0
   353 000003FE E8(00000000)                call printf
   354                                      
   355 00000403 48BF-                       mov rdi, resultat
   355 00000405 [5501000000000000] 
   356 0000040D 480FB63425-                 movzx rsi, byte[isInside]
   356 00000412 [59000000]         
   357 00000416 B800000000                  mov rax, 0
   358 0000041B E8(00000000)                call printf
   359                                          
   360                                  ;fenetre dessin   
   361 00000420 4831FF                  xor     rdi,rdi
   362 00000423 E8(00000000)            call    XOpenDisplay	; Création de display
   363 00000428 48890425[00000000]      mov     qword[display_name],rax	; rax=nom du display
   364                                  
   365                                  ; display_name structure
   366                                  ; screen = DefaultScreen(display_name);
   367 00000430 488B0425[00000000]      mov     rax,qword[display_name]
   368 00000438 8B80E0000000            mov     eax,dword[rax+0xe0]
   369 0000043E 890425[08000000]        mov     dword[screen],eax
   370                                  
   371 00000445 488B3C25[00000000]      mov rdi,qword[display_name]
   372 0000044D 8B3425[08000000]        mov esi,dword[screen]
   373 00000454 E8(00000000)            call XRootWindow
   374 00000459 4889C3                  mov rbx,rax
   375                                  
   376 0000045C 488B3C25[00000000]      mov rdi,qword[display_name]
   377 00000464 4889DE                  mov rsi,rbx
   378 00000467 BA0A000000              mov rdx,10
   379 0000046C B90A000000              mov rcx,10
   380 00000471 41B890010000            mov r8,400	; largeur
   381 00000477 41B990010000            mov r9,400	; hauteur
   382 0000047D 68FFFFFF00              push 0xFFFFFF	; background  0xRRGGBB
   383 00000482 6800FF0000              push 0x00FF00
   384 00000487 6A01                    push 1
   385 00000489 E8(00000000)            call XCreateSimpleWindow
   386 0000048E 48890425[1C000000]      mov qword[window],rax
   387                                  
   388 00000496 488B3C25[00000000]      mov rdi,qword[display_name]
   389 0000049E 488B3425[1C000000]      mov rsi,qword[window]
   390 000004A6 BA05000200              mov rdx,131077 ;131072
   391 000004AB E8(00000000)            call XSelectInput
   392                                  
   393 000004B0 488B3C25[00000000]      mov rdi,qword[display_name]
   394 000004B8 488B3425[1C000000]      mov rsi,qword[window]
   395 000004C0 E8(00000000)            call XMapWindow
   396                                  
   397 000004C5 488B3425[1C000000]      mov rsi,qword[window]
   398 000004CD BA00000000              mov rdx,0
   399 000004D2 B900000000              mov rcx,0
   400 000004D7 E8(00000000)            call XCreateGC
   401 000004DC 48890425[24000000]      mov qword[gc],rax
   402                                  
   403 000004E4 488B3C25[00000000]      mov rdi,qword[display_name]
   404 000004EC 488B3425[24000000]      mov rsi,qword[gc]
   405 000004F4 BA00000000              mov rdx,0x000000	; Couleur du crayon
   406 000004F9 E8(00000000)            call XSetForeground
   407                                  
   408                                  boucle: ; boucle de gestion des évènements
   409 000004FE 488B3C25[00000000]      mov rdi,qword[display_name]
   410 00000506 48BE-                   mov rsi,event
   410 00000508 [0000000000000000] 
   411 00000510 E8(00000000)            call XNextEvent
   412                                  
   413 00000515 833C25[00000000]16      cmp dword[event],ConfigureNotify	; à l'apparition de la fenêtre
   414 0000051D 7410                    je dessin			; on saute au label 'dessin'
   415                                  
   416 0000051F 833C25[00000000]02      cmp dword[event],KeyPress        ; Si on appuie sur une touche
   417 00000527 0F8489030000            je closeDisplay		        ; on saute au label 'closeDisplay' qui ferme la fenêtre
   418 0000052D EBCF                    jmp boucle
   419                                      
   420                                  ;#########################################
   421                                  ;#        DEBUT DE LA ZONE DE DESSIN     #
   422                                  ;#########################################
   423                                  dessin:
   424                                  
   425                                      ; boucle dessin point
   426                                      
   427 0000052F BB00000000                  mov rbx, 0  
   428                                      draw_point_loop:
   429                                  
   430                                          ;couleur du point 1
   431 00000534 488B3C25[00000000]              mov rdi,qword[display_name]
   432 0000053C 488B3425[24000000]              mov rsi,qword[gc]
   433 00000544 BA00000000                      mov edx,0x000000	; Couleur noire
   434 00000549 E8(00000000)                    call XSetForeground
   435                                          
   436                                          ; Dessin d'un point du point
   437 0000054E 488B3C25[00000000]              mov rdi,qword[display_name]
   438 00000556 488B3425[1C000000]              mov rsi,qword[window]
   439 0000055E 488B1425[24000000]              mov rdx,qword[gc]	
   440 00000566 480FB78C1B-                     movzx rcx, word [coordx+rbx*2] ; coordonnée en x du point généré
   440 0000056B [2C000000]         
   441 0000056F 83E903                          sub ecx,3		
   442 00000572 4C0FB7841B-                     movzx r8, word [coordy+rbx*2] ; coordonnée en y du point généré
   442 00000577 [36000000]         
   443 0000057B 4983E803                        sub r8,3
   444 0000057F 41B906000000                    mov r9,6
   445 00000585 B8005A0000                      mov rax,23040
   446 0000058A 50                              push rax
   447 0000058B 6A00                            push 0
   448 0000058D 4151                            push r9
   449 0000058F E8(00000000)                    call XFillArc
   450                                  
   451                                          ;++loopcounter
   452 00000594 48FFC3                          inc rbx
   453                                          
   454                                          ;check if end loop
   455 00000597 4883FB05                        cmp rbx, NUM_POINTS
   456 0000059B 7297                            jb draw_point_loop
   457                                          
   458                                          
   459 0000059D 48BF-                           mov rdi, printy
   459 0000059F [F700000000000000] 
   460 000005A7 480FB73425-                     movzx rsi, word[sizeEnveloppe]
   460 000005AC [4A000000]         
   461 000005B0 B800000000                      mov rax, 0
   462 000005B5 E8(00000000)                    call printf
   463                                      
   464                                      
   465                                      ; boucle dessin ligne
   466                                      
   467 000005BA BB00000000                  mov rbx, 0 
   468 000005BF B800000000                  mov rax, 0
   469                                  
   470                                      draw_line_loop:
   471                                  
   472                                          ;couleur de la ligne 1
   473 000005C4 488B3C25[00000000]              mov rdi,qword[display_name]
   474 000005CC 488B3425[24000000]              mov rsi,qword[gc]
   475 000005D4 BA00000000                      mov edx,0x000000	; Couleur du crayon ; noir
   476 000005D9 E8(00000000)                    call XSetForeground
   477                                          
   478                                          ;###debug
   479 000005DE 56                              push rsi
   480                                          
   481 000005DF 48BF-                           mov rdi, printy
   481 000005E1 [F700000000000000] 
   482 000005E9 4889DE                          mov rsi, rbx
   483 000005EC B800000000                      mov rax, 0
   484 000005F1 E8(00000000)                    call printf
   485                                          
   486 000005F6 480FB78C1B-                     movzx rcx, word[enveloppe+rbx*2]
   486 000005FB [40000000]         
   487 000005FF 48BF-                           mov rdi, env
   487 00000601 [3C01000000000000] 
   488 00000609 4889CE                          mov rsi, rcx
   489 0000060C B800000000                      mov rax, 0
   490 00000611 E8(00000000)                    call printf
   491                                          
   492 00000616 5E                              pop rsi
   493                                          ;;;;;;
   494                                          
   495                                          ;coordonnées de la ligne 1 (noire)
   496                                          
   497                                          ;Premier point
   498 00000617 480FB78C1B-                     movzx rcx, word[enveloppe+rbx*2]
   498 0000061C [40000000]         
   499                                          
   500                                          ;x
   501 00000620 0FB78409[2C000000]              movzx eax, word [coordx+rcx*2]
   502 00000628 890425[C0000000]                mov dword[x1],eax
   503 0000062F B800000000                      mov eax, 0
   504                                  
   505                                          ;y
   506 00000634 0FB78409[36000000]              movzx eax, word [coordy+rcx*2]
   507 0000063C 890425[C8000000]                mov dword[y1],eax
   508 00000643 B800000000                      mov eax, 0
   509                                          
   510                                          ;Second point
   511 00000648 48FFC3                          inc rbx
   512                                          
   513                                          ;if rcx = sizeEnveloppe, go back to 1rst point
   514 0000064B B900000000                      mov rcx, 0
   515 00000650 480FB70C25-                     movzx rcx, word[sizeEnveloppe]  
   515 00000655 [4A000000]         
   516 00000659 4839CB                          cmp rbx , rcx
   517 0000065C 0F8483000000                    je set_draw_last_point
   518                                          
   519 00000662 480FB78C1B-                     movzx rcx, word[enveloppe+rbx*2]
   519 00000667 [40000000]         
   520                                          
   521 0000066B 0FB78409[2C000000]              movzx eax, word [coordx+rcx*2]
   522 00000673 890425[C4000000]                mov dword[x2], eax
   523 0000067A B800000000                      mov eax, 0
   524                                          
   525 0000067F 0FB78409[36000000]              movzx eax, word [coordy+rcx*2]
   526 00000687 890425[CC000000]                mov dword[y2], eax
   527 0000068E B800000000                      mov eax, 0
   528                                          
   529                                          ; dessin de la ligne 1
   530 00000693 488B3C25[00000000]              mov rdi,qword[display_name]
   531 0000069B 488B3425[1C000000]              mov rsi,qword[window]
   532 000006A3 488B1425[24000000]              mov rdx,qword[gc]
   533 000006AB 8B0C25[C0000000]                mov ecx,dword[x1]	; coordonnée source en x
   534 000006B2 448B0425[C8000000]              mov r8d,dword[y1]	; coordonnée source en y
   535 000006BA 448B0C25[C4000000]              mov r9d,dword[x2]	; coordonnée destination en x
   536 000006C2 FF3425[CC000000]                push qword[y2]		; coordonnée destination en y
   537 000006C9 E8(00000000)                    call XDrawLine
   538                                          
   539                                          ;check if end loop
   540 000006CE B900000000                      mov rcx, 0
   541 000006D3 480FB70C25-                     movzx rcx, word[sizeEnveloppe]
   541 000006D8 [4A000000]         
   542 000006DC 4839CB                          cmp rbx , rcx
   543 000006DF 0F82DFFEFFFF                    jb draw_line_loop
   544                                          
   545                                          set_draw_last_point:    
   546 000006E5 BB00000000                          mov rbx, 0
   547 000006EA 480FB78C1B-                         movzx rcx, word[enveloppe+rbx*2]
   547 000006EF [40000000]         
   548                                              
   549 000006F3 0FB78409[2C000000]                  movzx eax, word [coordx+rcx*2]
   550 000006FB 890425[C4000000]                    mov dword[x2], eax
   551 00000702 B800000000                          mov eax, 0
   552                                              
   553 00000707 0FB78409[36000000]                  movzx eax, word [coordy+rcx*2]
   554 0000070F 890425[CC000000]                    mov dword[y2], eax
   555 00000716 B800000000                          mov eax, 0
   556                                              
   557                                              ; dessin de la ligne 1
   558 0000071B 488B3C25[00000000]                  mov rdi,qword[display_name]
   559 00000723 488B3425[1C000000]                  mov rsi,qword[window]
   560 0000072B 488B1425[24000000]                  mov rdx,qword[gc]
   561 00000733 8B0C25[C0000000]                    mov ecx,dword[x1]	; coordonnée source en x
   562 0000073A 448B0425[C8000000]                  mov r8d,dword[y1]	; coordonnée source en y
   563 00000742 448B0C25[C4000000]                  mov r9d,dword[x2]	; coordonnée destination en x
   564 0000074A FF3425[CC000000]                    push qword[y2]	; coordonnée destination en y
   565 00000751 E8(00000000)                        call XDrawLine
   566                                              ;jmp flush
   567                                          
   568                                  color_point_left:
   569                                          ;mov rbx, (le point en question)
   570 00000756 480FB71C25-                     movzx rbx, word[minpoint]
   570 0000075B [4D000000]         
   571                                          ;couleur du point 1
   572 0000075F 488B3C25[00000000]              mov rdi,qword[display_name]
   573 00000767 488B3425[24000000]              mov rsi,qword[gc]
   574 0000076F BAFF000000                      mov edx,0x0000FF	; Couleur bleu
   575 00000774 E8(00000000)                    call XSetForeground
   576                                          
   577                                          ; Dessin du point
   578 00000779 488B3C25[00000000]              mov rdi,qword[display_name]
   579 00000781 488B3425[1C000000]              mov rsi,qword[window]
   580 00000789 488B1425[24000000]              mov rdx,qword[gc]	
   581 00000791 480FB78C1B-                     movzx rcx, word [coordx+rbx*2] ; x
   581 00000796 [2C000000]         
   582 0000079A 83E903                          sub ecx,3		
   583 0000079D 4C0FB7841B-                     movzx r8, word [coordy+rbx*2] ; y
   583 000007A2 [36000000]         
   584 000007A6 4983E803                        sub r8,3
   585 000007AA 41B906000000                    mov r9,6
   586 000007B0 B8005A0000                      mov rax,23040
   587 000007B5 50                              push rax
   588 000007B6 6A00                            push 0
   589 000007B8 4151                            push r9
   590 000007BA E8(00000000)                    call XFillArc
   591                                          ;jmp flush    
   592                                       
   593                                  ;
   594                                  
   595                                      
   596 000007BF 480FB63425-                 movzx rsi, byte[isInside]
   596 000007C4 [59000000]         
   597 000007C8 B800000000                  mov rax, 0  
   598 000007CD 4839C6                      cmp rsi ,rax
   599 000007D0 7462                        je color_point_out       
   600                                  ;              
   601                                  color_point_in:
   602                                          ;mov rbx, (le point en question)
   603                                          ;mov rbx, 2
   604                                          ;couleur du point 1
   605 000007D2 488B3C25[00000000]              mov rdi,qword[display_name]
   606 000007DA 488B3425[24000000]              mov rsi,qword[gc]
   607 000007E2 BA00FF0000                      mov edx,0x00FF00	; Couleur vert
   608 000007E7 E8(00000000)                    call XSetForeground
   609                                          
   610                                          ; Dessin du point
   611 000007EC 488B3C25[00000000]              mov rdi,qword[display_name]
   612 000007F4 488B3425[1C000000]              mov rsi,qword[window]
   613 000007FC 488B1425[24000000]              mov rdx,qword[gc]	
   614 00000804 480FB70C25-                     movzx rcx, word[lastPointX] ; x
   614 00000809 [55000000]         
   615 0000080D 83E903                          sub ecx,3		
   616 00000810 4C0FB70425-                     movzx r8, word[lastPointY] ; y
   616 00000815 [57000000]         
   617 00000819 4983E803                        sub r8,3
   618 0000081D 41B906000000                    mov r9,6
   619 00000823 B8005A0000                      mov rax,23040
   620 00000828 50                              push rax
   621 00000829 6A00                            push 0
   622 0000082B 4151                            push r9
   623 0000082D E8(00000000)                    call XFillArc
   624 00000832 EB69                            jmp flush
   625                                          ;ret
   626                                          
   627                                  color_point_out:
   628                                          ;mov rbx, (le point en question)
   629 00000834 BB01000000                      mov rbx, 1
   630                                          ;couleur du point 1
   631 00000839 488B3C25[00000000]              mov rdi,qword[display_name]
   632 00000841 488B3425[24000000]              mov rsi,qword[gc]
   633 00000849 BA0000FF00                      mov edx,0xFF0000	; Couleur rouge
   634 0000084E E8(00000000)                    call XSetForeground
   635                                          
   636                                          ; Dessin du point
   637 00000853 488B3C25[00000000]              mov rdi,qword[display_name]
   638 0000085B 488B3425[1C000000]              mov rsi,qword[window]
   639 00000863 488B1425[24000000]              mov rdx,qword[gc]	
   640 0000086B 480FB70C25-                     movzx rcx, word[lastPointX] ; x
   640 00000870 [55000000]         
   641 00000874 83E903                          sub ecx,3		
   642 00000877 4C0FB70425-                     movzx r8, word[lastPointX] ; y
   642 0000087C [55000000]         
   643 00000880 4983E803                        sub r8,3
   644 00000884 41B906000000                    mov r9,6
   645 0000088A B8005A0000                      mov rax,23040
   646 0000088F 50                              push rax
   647 00000890 6A00                            push 0
   648 00000892 4151                            push r9
   649 00000894 E8(00000000)                    call XFillArc
   650 00000899 EB02                            jmp flush
   651                                          ;ret
   652                                  ; ############################
   653                                  ; # FIN DE LA ZONE DE DESSIN #
   654                                  ; ############################
   655 0000089B EB00                    jmp flush
   656                                  
   657                                  flush:
   658 0000089D 488B3C25[00000000]          mov rdi,qword[display_name]
   659 000008A5 E8(00000000)                call XFlush
   660 000008AA E94FFCFFFF                  jmp boucle
   661 000008AF B822000000                  mov rax,34
   662 000008B4 0F05                        syscall
   663                                  
   664                                  closeDisplay:
   665 000008B6 488B0425[00000000]          mov     rax,qword[display_name]
   666 000008BE 4889CF                      mov     rdi,rcx
   667 000008C1 E8(00000000)                call    XCloseDisplay
   668 000008C6 4831FF                      xor	    rdi,rdi
   669 000008C9 E8(00000000)                call    exit	
   670                                  
   671                                  ; Pour fermer le programme proprement :
   672 000008CE B83C000000              mov    rax, 60         
   673 000008D3 BF00000000              mov    rdi, 0
   674 000008D8 0F05                    syscall
   675                                  
   676 000008DA C3                      ret
